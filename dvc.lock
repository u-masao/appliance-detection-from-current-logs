schema: '2.0'
stages:
  convert_xml_to_parquet@env_temp:
    cmd: python -m src.data.convert_from_xml_to_parquet data/raw/env_temp.xml data/interim/env_temp.parquet
    deps:
    - path: data/raw/env_temp.xml
      hash: md5
      md5: d3c1ac14db8e84891f0a61c29c643190
      size: 72520793
    - path: src/data/convert_from_xml_to_parquet.py
      hash: md5
      md5: 88da0f001cf3fb2022198d2950a6d0b7
      size: 3876
    outs:
    - path: data/interim/env_temp.parquet
      hash: md5
      md5: 972a592a61627c5dcf256d340c33c62f
      size: 3221030
  convert_xml_to_parquet@star_watt:
    cmd: python -m src.data.convert_from_xml_to_parquet data/raw/star_watt.xml data/interim/star_watt.parquet
    deps:
    - path: data/raw/star_watt.xml
      hash: md5
      md5: 3e48c4b58b5edc3c96417d6b3a3c876f
      size: 649685660
    - path: src/data/convert_from_xml_to_parquet.py
      hash: md5
      md5: 88da0f001cf3fb2022198d2950a6d0b7
      size: 3876
    outs:
    - path: data/interim/star_watt.parquet
      hash: md5
      md5: 26c3f17d550c58ce045d9de9b83f70ff
      size: 38166479
  merge_parquet_files:
    cmd: python src/data/merge_parquet_files.py data/interim/env_temp.parquet data/interim/star_watt.parquet
      data/interim/dataset.parquet
    deps:
    - path: data/interim/env_temp.parquet
      hash: md5
      md5: 972a592a61627c5dcf256d340c33c62f
      size: 3221030
    - path: data/interim/star_watt.parquet
      hash: md5
      md5: 26c3f17d550c58ce045d9de9b83f70ff
      size: 38166479
    - path: src/data/merge_parquet_files.py
      hash: md5
      md5: fac7b361a3c766a6ab0fab6c497217e7
      size: 4908
    outs:
    - path: data/interim/dataset.parquet
      hash: md5
      md5: 794d570f00a5b78c66a1f0b1257e6223
      size: 39634109
  build_features:
    cmd: python src/features/build_features.py data/interim/dataset.parquet data/interim/features.parquet
    deps:
    - path: data/interim/dataset.parquet
      hash: md5
      md5: 794d570f00a5b78c66a1f0b1257e6223
      size: 39634109
    - path: src/features/build_features.py
      hash: md5
      md5: b04dcf20233d77e410501b0fb6c69d9f
      size: 3063
    outs:
    - path: data/interim/features.parquet
      hash: md5
      md5: 7d35071f74474cc1cfcfb0a3c20048a2
      size: 62374605
  train_model:
    cmd: python -m src.models.train_model data/interim/train.parquet data/interim/val.parquet
      models/best_model.pth --data_fraction 1 --n_trials 1 --num_epochs 100 --batch_size
      64 --input_sequence_length 360 --output_sequence_length 5 --embed_dim 20 --num_workers
      4 --checkpoint_interval 1 --nhead 10 --lr 0.001
    deps:
    - path: data/interim/train.parquet
      hash: md5
      md5: 585430d1f957be95bd4366b431131030
      size: 44418257
    - path: data/interim/val.parquet
      hash: md5
      md5: 400c6246e4fdae17a1e987fc1a634f0c
      size: 11223072
    - path: src/models/dataset.py
      hash: md5
      md5: 37a1d3271859135a6c9bc2a4dc1c84a5
      size: 2104
    - path: src/models/model.py
      hash: md5
      md5: 4436dd3557f0282e98776638d22fa0c1
      size: 6091
    - path: src/models/train_model.py
      hash: md5
      md5: 612c1caeea37d007af8e6e99632272ca
      size: 14227
    outs:
    - path: models/best_model.pth
      hash: md5
      md5: 62537731d7338cb3548d6dc4569f4e11
      size: 532386
    - path: models/checkpoint/
      hash: md5
      md5: 48435568787aa918449f54db3f855a12.dir
      size: 8531360
      nfiles: 16
  split_data:
    cmd: python src/data/split_data.py data/interim/features.parquet data/interim/train.parquet
      data/interim/val.parquet data/interim/test.parquet --train_ratio 0.7 --val_ratio
      0.15 --input_sequence_length 360
    deps:
    - path: data/interim/features.parquet
      hash: md5
      md5: 7d35071f74474cc1cfcfb0a3c20048a2
      size: 62374605
    - path: src/data/split_data.py
      hash: md5
      md5: 898e64859e88232bf0529151b7fd2e9f
      size: 2797
    outs:
    - path: data/interim/test.parquet
      hash: md5
      md5: 6c2de4ff0708a0b476d96a0da94f8738
      size: 11288189
    - path: data/interim/train.parquet
      hash: md5
      md5: 585430d1f957be95bd4366b431131030
      size: 44418257
    - path: data/interim/val.parquet
      hash: md5
      md5: 400c6246e4fdae17a1e987fc1a634f0c
      size: 11223072
  inference:
    cmd: python src/models/inference.py models/best_model.pth data/interim/features.parquet
      --input_length 180 --output_length 5 --batch_size 128 --device cpu
    deps:
    - path: data/interim/features.parquet
      hash: md5
      md5: 892b254eae278e9458da1bd156b1c41f
      size: 62374638
    - path: models/best_model.pth
      hash: md5
      md5: 34c72625e74f4ebba40c3e94b52d6a41
      size: 7128598
    - path: src/models/inference.py
      hash: md5
      md5: 3b76ec1667ad21a390b07478c85dcd0d
      size: 4121
  inference@train:
    cmd: python -m src.models.inference models/best_model.pth data/interim/train.parquet
      data/interim/infer_train.parquet --batch_size 32 --data_fraction 0.01 --input_sequence_length
      60 --output_sequence_length 2 --data_fraction 0.01
    deps:
    - path: data/interim/train.parquet
      hash: md5
      md5: e27365e2b010cbd27ea698c2496b2cec
      size: 44417877
    - path: models/best_model.pth
      hash: md5
      md5: da983946c0c3749932ba4ef8e9714f1d
      size: 2029218
    - path: src/models/dataset.py
      hash: md5
      md5: 37a1d3271859135a6c9bc2a4dc1c84a5
      size: 2104
    - path: src/models/inference.py
      hash: md5
      md5: 90d3067f0805f659a6bc586930886726
      size: 4733
    - path: src/models/model.py
      hash: md5
      md5: 486579cf694462d980b168ccbcb05c7d
      size: 5886
    outs:
    - path: data/interim/infer_train.parquet
      hash: md5
      md5: dce90683f98845e3ce81b1df5a612232
      size: 18646220
  inference@val:
    cmd: python -m src.models.inference models/best_model.pth data/interim/val.parquet
      data/interim/infer_val.parquet --batch_size 32 --data_fraction 0.01 --input_sequence_length
      60 --output_sequence_length 2 --data_fraction 0.01
    deps:
    - path: data/interim/val.parquet
      hash: md5
      md5: b74c9b4b4e68908792143c2ddb6a074e
      size: 11210111
    - path: models/best_model.pth
      hash: md5
      md5: da983946c0c3749932ba4ef8e9714f1d
      size: 2029218
    - path: src/models/dataset.py
      hash: md5
      md5: 37a1d3271859135a6c9bc2a4dc1c84a5
      size: 2104
    - path: src/models/inference.py
      hash: md5
      md5: 90d3067f0805f659a6bc586930886726
      size: 4733
    - path: src/models/model.py
      hash: md5
      md5: 486579cf694462d980b168ccbcb05c7d
      size: 5886
    outs:
    - path: data/interim/infer_val.parquet
      hash: md5
      md5: 842365cfb6fe1068fe9a62d2fd88d390
      size: 4019410
  inference@test:
    cmd: python -m src.models.inference models/best_model.pth data/interim/test.parquet
      data/interim/infer_test.parquet --batch_size 32 --data_fraction 0.01 --input_sequence_length
      60 --output_sequence_length 2 --data_fraction 0.01
    deps:
    - path: data/interim/test.parquet
      hash: md5
      md5: 8a74d3b438a1836555e06f416f0a96b8
      size: 11321116
    - path: models/best_model.pth
      hash: md5
      md5: da983946c0c3749932ba4ef8e9714f1d
      size: 2029218
    - path: src/models/dataset.py
      hash: md5
      md5: 37a1d3271859135a6c9bc2a4dc1c84a5
      size: 2104
    - path: src/models/inference.py
      hash: md5
      md5: 90d3067f0805f659a6bc586930886726
      size: 4733
    - path: src/models/model.py
      hash: md5
      md5: 486579cf694462d980b168ccbcb05c7d
      size: 5886
    outs:
    - path: data/interim/infer_test.parquet
      hash: md5
      md5: fc04148a37b64167811e50a4bd955b1e
      size: 4028882
  convert_to_csv@train:
    cmd: python -m src.data.convert_to_csv data/interim/train.parquet data/processed/csv/train/
      --split monthly --data_fraction 1
    deps:
    - path: data/interim/train.parquet
      hash: md5
      md5: 585430d1f957be95bd4366b431131030
      size: 44418257
    - path: src/data/convert_to_csv.py
      hash: md5
      md5: 24f3387b66195e7a36b5a5f0244e4b26
      size: 4918
    outs:
    - path: data/processed/csv/train/
      hash: md5
      md5: 114e7015c37def3060dce21299711184.dir
      size: 178586408
      nfiles: 89
  convert_to_csv@val:
    cmd: python -m src.data.convert_to_csv data/interim/val.parquet data/processed/csv/val/
      --split monthly --data_fraction 1
    deps:
    - path: data/interim/val.parquet
      hash: md5
      md5: 400c6246e4fdae17a1e987fc1a634f0c
      size: 11223072
    - path: src/data/convert_to_csv.py
      hash: md5
      md5: 24f3387b66195e7a36b5a5f0244e4b26
      size: 4918
    outs:
    - path: data/processed/csv/val/
      hash: md5
      md5: 5095ab5311fa190df269f355a831856f.dir
      size: 38214372
      nfiles: 18
  convert_to_csv@test:
    cmd: python -m src.data.convert_to_csv data/interim/test.parquet data/processed/csv/test/
      --split monthly --data_fraction 1
    deps:
    - path: data/interim/test.parquet
      hash: md5
      md5: 6c2de4ff0708a0b476d96a0da94f8738
      size: 11288189
    - path: src/data/convert_to_csv.py
      hash: md5
      md5: 24f3387b66195e7a36b5a5f0244e4b26
      size: 4918
    outs:
    - path: data/processed/csv/test/
      hash: md5
      md5: 57ac039707540de0b38a775d3d347c5d.dir
      size: 38029632
      nfiles: 19
