schema: '2.0'
stages:
  convert_xml_to_parquet@env_temp:
    cmd: python -m src.data.convert_from_xml_to_parquet data/raw/env_temp.xml data/interim/env_temp.parquet
    deps:
    - path: data/raw/env_temp.xml
      hash: md5
      md5: d3c1ac14db8e84891f0a61c29c643190
      size: 72520793
    - path: src/data/convert_from_xml_to_parquet.py
      hash: md5
      md5: 88da0f001cf3fb2022198d2950a6d0b7
      size: 3876
    outs:
    - path: data/interim/env_temp.parquet
      hash: md5
      md5: 972a592a61627c5dcf256d340c33c62f
      size: 3221030
  convert_xml_to_parquet@star_watt:
    cmd: python -m src.data.convert_from_xml_to_parquet data/raw/star_watt.xml data/interim/star_watt.parquet
    deps:
    - path: data/raw/star_watt.xml
      hash: md5
      md5: 3e48c4b58b5edc3c96417d6b3a3c876f
      size: 649685660
    - path: src/data/convert_from_xml_to_parquet.py
      hash: md5
      md5: 88da0f001cf3fb2022198d2950a6d0b7
      size: 3876
    outs:
    - path: data/interim/star_watt.parquet
      hash: md5
      md5: 26c3f17d550c58ce045d9de9b83f70ff
      size: 38166479
  merge_parquet_files:
    cmd: python src/data/merge_parquet_files.py data/interim/env_temp.parquet data/interim/star_watt.parquet
      data/interim/dataset.parquet
    deps:
    - path: data/interim/env_temp.parquet
      hash: md5
      md5: 972a592a61627c5dcf256d340c33c62f
      size: 3221030
    - path: data/interim/star_watt.parquet
      hash: md5
      md5: 26c3f17d550c58ce045d9de9b83f70ff
      size: 38166479
    - path: src/data/merge_parquet_files.py
      hash: md5
      md5: fe6bda10f7206e708b7ad6bc111a1126
      size: 4906
    outs:
    - path: data/interim/dataset.parquet
      hash: md5
      md5: 794d570f00a5b78c66a1f0b1257e6223
      size: 39634109
  build_features:
    cmd: python src/features/build_features.py data/interim/dataset.parquet data/interim/features.parquet
    deps:
    - path: data/interim/dataset.parquet
      hash: md5
      md5: 794d570f00a5b78c66a1f0b1257e6223
      size: 39634109
    - path: src/features/build_features.py
      hash: md5
      md5: 9d8c7b2328cca512768820830dbbcaa7
      size: 2721
    outs:
    - path: data/interim/features.parquet
      hash: md5
      md5: 892b254eae278e9458da1bd156b1c41f
      size: 62374638
  train_model:
    cmd: python -m src.models.train_model data/interim/train.parquet data/interim/val.parquet
      data/interim/test.parquet models/best_model.pth --data_fraction 0.01 --n_trials
      1 --num_epochs 1 --batch_size 128 --input_length 180 --output_length 5
    deps:
    - path: data/interim/test.parquet
      hash: md5
      md5: 9e9c3e829c2103c432adfe85b9a4de00
      size: 11313473
    - path: data/interim/train.parquet
      hash: md5
      md5: e27365e2b010cbd27ea698c2496b2cec
      size: 44417877
    - path: data/interim/val.parquet
      hash: md5
      md5: 4d3c7e162e0314cb3cf7dc75b83b1c88
      size: 11212554
    - path: src/models/dataset.py
      hash: md5
      md5: 6e029035c84ec3dd3a7575653a00fa8b
      size: 1166
    - path: src/models/model.py
      hash: md5
      md5: 5d12b9d40cf8e7c7dce4cdb40f4948c1
      size: 1331
    - path: src/models/train_model.py
      hash: md5
      md5: 7ad6f7f2f586f107f544df64dbd98d11
      size: 9447
    outs:
    - path: models/best_model.pth
      hash: md5
      md5: 63b4b169bb34f0dff6aece713ee9d5d3
      size: 8014154
  split_data:
    cmd: python src/data/split_data.py data/interim/features.parquet data/interim/train.parquet
      data/interim/val.parquet data/interim/test.parquet --train_ratio 0.7 --val_ratio
      0.15 --input_length 180
    deps:
    - path: data/interim/features.parquet
      hash: md5
      md5: 892b254eae278e9458da1bd156b1c41f
      size: 62374638
    - path: src/data/split_data.py
      hash: md5
      md5: 24601373dad03a6436eec7a3ca5edb43
      size: 2663
    outs:
    - path: data/interim/test.parquet
      hash: md5
      md5: 9e9c3e829c2103c432adfe85b9a4de00
      size: 11313473
    - path: data/interim/train.parquet
      hash: md5
      md5: e27365e2b010cbd27ea698c2496b2cec
      size: 44417877
    - path: data/interim/val.parquet
      hash: md5
      md5: 4d3c7e162e0314cb3cf7dc75b83b1c88
      size: 11212554
  inference:
    cmd: python src/models/inference.py models/best_model.pth data/interim/features.parquet
      --input_length 180 --output_length 5 --batch_size 128 --device cpu
    deps:
    - path: data/interim/features.parquet
      hash: md5
      md5: 892b254eae278e9458da1bd156b1c41f
      size: 62374638
    - path: models/best_model.pth
      hash: md5
      md5: 34c72625e74f4ebba40c3e94b52d6a41
      size: 7128598
    - path: src/models/inference.py
      hash: md5
      md5: 3b76ec1667ad21a390b07478c85dcd0d
      size: 4121
  inference@train:
    cmd: python -m src.models.inference models/best_model.pth data/interim/train.parquet
      data/interim/infer_train.parquet --batch_size 128 --device cpu --data_fraction
      0.01
    deps:
    - path: data/interim/train.parquet
      hash: md5
      md5: e27365e2b010cbd27ea698c2496b2cec
      size: 44417877
    - path: models/best_model.pth
      hash: md5
      md5: 63b4b169bb34f0dff6aece713ee9d5d3
      size: 8014154
    - path: src/models/dataset.py
      hash: md5
      md5: 6e029035c84ec3dd3a7575653a00fa8b
      size: 1166
    - path: src/models/inference.py
      hash: md5
      md5: e58f8c0aacf1a2877b89f6a89658a9b6
      size: 4077
    - path: src/models/model.py
      hash: md5
      md5: 5d12b9d40cf8e7c7dce4cdb40f4948c1
      size: 1331
    outs:
    - path: data/interim/infer_train.parquet
      hash: md5
      md5: 98dc1d99a46a1ce6c8e988146d7383db
      size: 48392161
  inference@val:
    cmd: python -m src.models.inference models/best_model.pth data/interim/val.parquet
      data/interim/infer_val.parquet --batch_size 128 --device cpu --data_fraction
      0.01
    deps:
    - path: data/interim/val.parquet
      hash: md5
      md5: 4d3c7e162e0314cb3cf7dc75b83b1c88
      size: 11212554
    - path: models/best_model.pth
      hash: md5
      md5: 63b4b169bb34f0dff6aece713ee9d5d3
      size: 8014154
    - path: src/models/dataset.py
      hash: md5
      md5: 6e029035c84ec3dd3a7575653a00fa8b
      size: 1166
    - path: src/models/inference.py
      hash: md5
      md5: e58f8c0aacf1a2877b89f6a89658a9b6
      size: 4077
    - path: src/models/model.py
      hash: md5
      md5: 5d12b9d40cf8e7c7dce4cdb40f4948c1
      size: 1331
    outs:
    - path: data/interim/infer_val.parquet
      hash: md5
      md5: f7f9ff7185f5de972b87425eff94a1fd
      size: 9769892
  inference@test:
    cmd: python -m src.models.inference models/best_model.pth data/interim/test.parquet
      data/interim/infer_test.parquet --batch_size 128 --device cpu --data_fraction
      0.01
    deps:
    - path: data/interim/test.parquet
      hash: md5
      md5: 9e9c3e829c2103c432adfe85b9a4de00
      size: 11313473
    - path: models/best_model.pth
      hash: md5
      md5: 63b4b169bb34f0dff6aece713ee9d5d3
      size: 8014154
    - path: src/models/dataset.py
      hash: md5
      md5: 6e029035c84ec3dd3a7575653a00fa8b
      size: 1166
    - path: src/models/inference.py
      hash: md5
      md5: e58f8c0aacf1a2877b89f6a89658a9b6
      size: 4077
    - path: src/models/model.py
      hash: md5
      md5: 5d12b9d40cf8e7c7dce4cdb40f4948c1
      size: 1331
    outs:
    - path: data/interim/infer_test.parquet
      hash: md5
      md5: b0eee3313ef20897e55e41928f176542
      size: 9782170
